# v1.1.0 アップデートのお知らせ

> Yejingram v1.1.0 のアップデート内容です。

今回の v1.1.0 では、以下の新機能と改善が含まれています。

- Yejingram: https://yejingram.com/
- Yejingram (開発プレビュー): https://dev.yejingram.com/

> 注意事項: 開発プレビューサイトは予告なく変更される可能性があります。開発中のデータベース構造の変更や不具合によりデータ損失が発生する場合があり、これは避けられません。これについて Yejingram 開発チームは責任を負いません。

---

## 新しい機能

- メモリ転送機能の追加
- 手動メッセージリクエスト機能の追加（キャラクターから“先にトーク”を開始させる）
- グループチャットで「続けて応答」機能を有効化
- プロフィール画像参照トグル機能の追加
- データ保存方式の変更
- OpenRouter サポート
- DeepSeek サポート
- Custom LLM 利用時のトークナイザ / ペイロード形式設定サポート

## 改善された機能

- 意図しないメッセージコントロールボタンのタップ防止
- 初期ページロード速度改善（tiktoken 読み込み方式変更）
- ステッカー関連の不具合修正（表示解像度など）
- END_OF_TURN エラー防止
- reactionDelay の上限適用

## 主な追加 / 改善機能の詳細

### メモリ転送機能

<img width="400" alt="image" src="https://github.com/user-attachments/assets/605c84f8-9d33-4182-93b8-50ea5fd85a10" />

あるチャットルームに蓄積されたメモリを別のチャットルームへ移すことができます。

<img width="400" alt="image" src="https://github.com/user-attachments/assets/2674a3db-1744-4e85-bfc5-fa9ebca99e98" />

元のチャットルーム側のメモリは削除されず、必要であれば手動で全削除できます。転送されたメモリは他のチャットルームに順次登録されます。これを利用して、個人トークで育てたメモリを持ったまま新しくグループチャットを作成する応用も可能です。

### 手動先メッセージ機能

<img width="400" alt="image" src="https://github.com/user-attachments/assets/eb8e9d6d-a080-4d59-a271-b7812e2094ee" />

入力パネルメニューに「先トーク要求」ボタンが追加されました。キャラクターが既存のチャット履歴や時点をもとに先にメッセージを送ってくれます！

キャラクターが完全にランダムな時間にユーザー要求なしで先にメッセージを送る形は技術的理由で実現が難しいため、キャラクターの“先トーク”をシミュレーションできる方向で開発しました。

<img width="400" alt="image" src="https://github.com/user-attachments/assets/dd192a12-b81d-4c2b-ad0d-b98c7ade1ef9" />

> キャラクター開始メッセージ例

<img width="400" alt="image" src="https://github.com/user-attachments/assets/60646b76-209e-4673-9315-01c2cd374b8c" />

<img width="400" alt="image" src="https://github.com/user-attachments/assets/d1c06950-6b3b-44f3-81e9-de43d01b8f49" />

> コンテキストに基づくキャラクター先トーク例

### END_OF_TURN エラー防止

<img width="400" alt="image" src="https://github.com/user-attachments/assets/43dbb5a1-9392-47d2-8b20-0222dfcd7922" />

「続けて応答」やグループチャット利用時に、まれに END_OF_TURN エラーが発生する問題を確認していました。

今回のパッチで該当箇所を修正し、グループチャットでも「続けて応答」機能が利用できるようになりました！

### プロフィール画像参照トグル

<img width="400" alt="image" src="https://github.com/user-attachments/assets/a58282e3-c561-452c-b54f-4b532be14288" />

従来は画像生成要求時、プロフィール画像が常に参照として含まれていました。この挙動を切り替えられるボタンを追加しました。画像にホバー（モバイルはタップ）すると表示されるアクション群の中で、青色表示なら参照使用オン、消えていればオフです。デフォルトはオンに固定されています。

### データ保存方式の変更

<img width="400" alt="image" src="https://github.com/user-attachments/assets/4ebd948d-9d9f-41e6-8d94-6335bdeaf2c7" />

Chromium 系ブラウザ（Chrome, Samsung Internet, Edge など）でセーブ容量が 100MB を超えるとアプリがクラッシュする現象を確認しました。これを改善するため、データ保存方式の一部を変更しました。既存のセーブデータはそのまま使用可能です。

### OpenRouter / DeepSeek サポート

<img width="400" alt="image" src="https://github.com/user-attachments/assets/1b99eb41-2448-4159-ae16-a556988baf67" />

<img width="400" alt="image" src="https://github.com/user-attachments/assets/cc91d2c0-173e-4013-8e99-2dd808d57ea4" />

AI 設定で OpenRouter と DeepSeek を利用できるようになりました！

### Custom LLM 関連設定の拡張

<img width="400" alt="image" src="https://github.com/user-attachments/assets/406de045-9c9b-4902-a0c7-3a4818a9eb01" />

Custom LLM を利用する場合、より柔軟に設定できるようトークナイザとペイロード形式の選択欄を追加しました。選択可能なオプションは以下です。

- トークナイザ: OpenAI (o200k_base, cl100k_base), DeepSeek, Llama2, Llama3, Llama4, Mistral, Qwen, Qwen3
- ペイロード: OpenAI, Anthropic, Gemini

### reactionDelay 上限適用

構造化出力を使用する際、キャラクターからの応答表示待機時間 reactionDelay が LLM の“現実的すぎる”出力により不要に長くなるケースを確認しました。

<img width="400" alt="image" src="https://github.com/user-attachments/assets/f10856a5-b440-4f31-8f1c-76e87aff2aee" />

「会議に行ってくる」というキャラクターを 3 時間待つような事態を避けるため、reactionDelay の上限を 10 秒に設定しました。

---

## まとめ

いつも Yejingram をご利用いただきありがとうございます！ これからも皆さんが楽しく使えるよう、便利な機能と快適な環境づくりに努めてまいります。

[Yejingram GitHub はこちら](https://github.com/YEJIN-DEV/yejingram) からコントリビュートできます。いつでも PR は歓迎ですので、ぜひご参加ください！
